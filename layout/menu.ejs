<% var rootlink = config.root %> 
<nav id="menu">
    <div class="desktop-menu">
        <a href="<%- rootlink %>">
            <span class="title"><%- config.title %></span>
        </a>
        <% Object.keys(theme.menu).forEach(key => { %>
        <a href="<%=theme.menu[key].src%>">
            <span>
                <a-icon type="<%- theme.menu[key].icon.name %>" theme="<%- theme.menu[key].icon.theme %>" />
            </span>
            <span><%=key%></span>
        </a>
        <% }); %>
        
        <!-- 搜索按钮 -->
        <div class="search-container" style="position: absolute; right: 20px; top: 50%; transform: translateY(-50%);">
            <div class="search-button" onclick="toggleSearch()" style="cursor: pointer; padding: 8px; transition: all 0.3s; color: inherit;">
                <a-icon type="search" style="font-size: 20px; color: inherit;" />
            </div>
            <div id="search-dropdown" style="display: none; position: absolute; top: 50px; right: 0; width: 400px; max-height: 500px; background: white; border-radius: 10px; box-shadow: 0 8px 30px rgba(0,0,0,0.15); overflow: hidden; z-index: 1000;">
                <div style="padding: 15px; border-bottom: 1px solid #eee;">
                    <input id="search-input" type="text" placeholder="搜索文章..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; outline: none;" oninput="searchPosts(this.value)">
                </div>
                <div id="search-results" style="max-height: 400px; overflow-y: auto; padding: 10px;">
                    <div style="text-align: center; color: #999; padding: 20px;">输入关键词搜索文章</div>
                </div>
            </div>
        </div>
    </div>

    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div :class="'title'" @click="menu_show=!menu_show">
            <span style="margin-right: 10px;">
                <a-icon type="appstore" theme="filled" />
            </span>
            <span><%- config.title %></span>
        </div>
        <div class="items" v-show="menu_show">
            <% Object.keys(theme.menu).forEach(key => { %>
            <a href="<%=theme.menu[key].src%>">
                <div class="item">
                    <div style="min-width:20px; max-width:50px; width: 10%">
                        <a-icon type="<%- theme.menu[key].icon.name %>" theme="<%- theme.menu[key].icon.theme %>" />
                    </div>
                    <div style="min-width:100px;max-width: 150%;width: 20%;"><%=key%></div>
                </div>
            </a>
            <% }); %>
        </div>
        <div class="curtain" v-show="menu_show"></div>
    </div>

</nav>

<script>
// 存储所有文章数据
const allPosts = [
    <% site.posts.forEach(function(post, index){ %>
    {
        title: "<%- post.title.replace(/"/g, '\\"') %>",
        path: "<%- url_for(post.path) %>",
        date: "<%- date(post.date, 'YYYY/M/D') %>",
        excerpt: "<%- (post.excerpt || post.content).substring(0, 100).replace(/"/g, '\\"').replace(/\n/g, ' ') %>..."
    }<% if(index < site.posts.length - 1){ %>,<% } %>
    <% }); %>
];

function toggleSearch() {
    const dropdown = document.getElementById('search-dropdown');
    if (dropdown.style.display === 'none') {
        dropdown.style.display = 'block';
        document.getElementById('search-input').focus();
        document.addEventListener('click', closeSearchOnClickOutside);
    } else {
        dropdown.style.display = 'none';
        document.removeEventListener('click', closeSearchOnClickOutside);
    }
}

function closeSearchOnClickOutside(event) {
    const container = document.querySelector('.search-container');
    if (!container.contains(event.target)) {
        document.getElementById('search-dropdown').style.display = 'none';
        document.removeEventListener('click', closeSearchOnClickOutside);
    }
}

function searchPosts(keyword) {
    const resultsContainer = document.getElementById('search-results');
    
    if (!keyword.trim()) {
        resultsContainer.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">输入关键词搜索文章</div>';
        return;
    }
    
    const results = allPosts.filter(post => 
        post.title.toLowerCase().includes(keyword.toLowerCase()) ||
        post.excerpt.toLowerCase().includes(keyword.toLowerCase())
    );
    
    if (results.length === 0) {
        resultsContainer.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">未找到相关文章</div>';
        return;
    }
    
    resultsContainer.innerHTML = results.map(post => `
        <a href="${post.path}" style="display: block; padding: 12px; margin: 5px 0; border-radius: 6px; text-decoration: none; color: #333; transition: all 0.3s;" 
           onmouseover="this.style.background='#f5f5f5'" 
           onmouseout="this.style.background='transparent'">
            <div style="font-weight: 500; margin-bottom: 5px; color: #ff728b;">${post.title}</div>
            <div style="font-size: 12px; color: #999; margin-bottom: 5px;">${post.date}</div>
            <div style="font-size: 13px; color: #666; line-height: 1.4;">${post.excerpt}</div>
        </a>
    `).join('');
}
</script>